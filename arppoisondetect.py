from scapy.all import *

def analyze_pcap(pcap_file):
    packets = rdpcap(pcap_file)
    arp_packets = [pkt for pkt in packets if ARP in pkt]

    ip_mac_mapping = {}
    duplicate_mappings = []
    attacker_mac = None
    attacker_ip = None

    for pkt in arp_packets:
        ip = pkt[ARP].psrc
        mac = pkt[ARP].hwsrc

        if ip in ip_mac_mapping:
            if ip_mac_mapping[ip] != mac:
                duplicate_mappings.append((ip, ip_mac_mapping[ip], mac))
                attacker_ip = ip
                attacker_mac = mac
        else:
            ip_mac_mapping[ip] = mac

    if duplicate_mappings:
        print("Potential ARP poisoning detected:")
        for ip, orig_mac, new_mac in duplicate_mappings:
            print("IP: {}  Original MAC: {}  New MAC: {}".format(ip, orig_mac, new_mac))
        print("Attacker IP: {}  Attacker MAC: {}".format(attacker_ip, attacker_mac))
    else:
        print("No evidence of ARP poisoning in the pcap file.")

# Provide the path to your pcap file
pcap_file = "SBT-PCAP3.pcapng"

analyze_pcap(pcap_file)
